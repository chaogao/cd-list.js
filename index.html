<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta charset="utf-8">
    </head>
    <body>
        <div class="custom-filter">
          <ul>
            <li>
              <a data-type="1" href="javascript:void(0)">互联网</a>

              <ul>
                <li>
                  <a data-type="2" href="javascript:void(0)">前端</a>
                </li>

                <li>
                  <a data-type="3" href="javascript:void(0)">后端</a>
                </li>

                <li>
                  <a data-type="4" href="javascript:void(0)">APP开发</a>
                </li>
              </ul>
            </li>
          </ul>
        </div>

        <div id="mysearh-wrap"></div>
        <div id="filter-wrap"></div>
        <div id="cdlist-demo"></div>

        <style>
          .custom-filter a.active {
            color: red;
          }

          .mod-page-item-active {
            color: red;
          }
          .cdlist-sort-item-active {
            color: red;
          }

          .cdlist-sort-item-active {
            color: red;
          }

          .cdlist-sort-type-desc:after {
            content: " down";
            color: blue;
          }

          .cdlist-sort-type-asc:after {
            content: " up";
            color: blue;
          }
        </style>
        <script type="text/javascript" src="//cdn.bootcss.com/jquery/3.1.1/jquery.js" charset="utf-8"></script>
        <script type="text/javascript" src="/lib/cdlist.js" charset="utf-8"></script>

        <script>
          var sort = window.sort = new CdList.addons.Sort({
            historyEnable: 1,

            datas: [
              {
                key: 'defautl',
                name: '默认'
              },
              {
                key: 'price',
                name: '价格排序',
                types: [
                  CdList.addons.Sort.SORT_MAP.ASC,
                  CdList.addons.Sort.SORT_MAP.DESC
                ]
              },
              {
                key: 'time',
                name: '时间排序',
                types: [
                  CdList.addons.Sort.SORT_MAP.ASC,
                  CdList.addons.Sort.SORT_MAP.DESC
                ]
              }
            ]
          });

          var search = window.search = new CdList.addons.Search({
            btnText: '点我吧！',

            placeholder: '需要输入1开头的数字',

            val: '133',

            regex: /^1\d+/,

            historyEnable: true,

            historyKey: 'mysearch',

            container: '#mysearh-wrap'
          });

          search.on('error', function (e, value) {
            alert(value + '你输入错了');
          });

          var pg = window.pg = new CdList.addons.Pagination({
            pagination: {
              allwaysShow: false,

              maxShowPage: 5,

              textLabel: ['头', '上', '下', '尾']
            },

            historyEnable: true,


            getSetting: function (json) {
              return {
                total: 10
              }
            }
          });

          var filter = window.filter = new CdList.addons.Filter({
            historyEnable: 1,

            line: 1,

            container: '#filter-wrap',

            filters: [
              {
                label: '用户属性',

                name: 'usertype',

                activeIndex: 1,

                className: 'item-usertype',

                historyKey: 'my-usertype',

                datas: [
                  { name: '不限', value: 0 },
                  { name: '僵尸用户', value: '1' },
                  { name: '活跃用户', value: '2' }
                ]
              }
            ]
          });

          var cdList = window.cdlist = new CdList({
            disableHistory: false,

            getUrl: function (data) {
              var param = {};

              console.log(data);

              return '/ajax.json'
            },

            getAjaxData: function (url) {
              return $.ajax({
                url: url,
                dataType: 'json'
              });
            },

            rows: function (item) {
              return '<li>hi:' + item.name + '</li>'
            },

            getRowsData: function (json) {
              return json.list;
            },

            addons: [search, sort, filter, pg]
          }, '#cdlist-demo');

          cdList.on('created', function () {
            alert(1);
          });

          cdList.getList();

          // 自身改变影响其他插件
          $('.custom-filter').delegate('a', 'click', function () {
            var type = $(this).data('type');

            $('.custom-filter').find('.active').removeClass('active');

            $(this).addClass('active');

            cdList.setHistory('custom-type', type);
            cdList.trigger('pagination.reset');
            cdList.trigger('sort.reset');
            cdList.trigger('reflow');
          });

        </script>
    </body>
</html>
